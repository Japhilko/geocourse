---
title: "B5 Simple Features"
author: "Jan-Philipp Kolb"
date: "23 Oktober 2018"
output:
  beamer_presentation:
    colortheme: beaver
    fonttheme: structurebold
    highlight: tango
    fig_caption: no
    keep_tex: yes
    theme: CambridgeUS
  slidy_presentation: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE,fig.height=4)
athome <- T
```

## Themen dieses Abschnitts

- Der Import von Geodaten mit dem Paket simple features (`sf`).
- Die Verarbeitung der OSM-Daten mit dem Paket `sf`.
- Die Daten visualisieren mit `sf`


## Das Paket `sf`

> Simple Features for R 

```{r}
library(sf)
```

- Ein Demo ist im Paket `sf` integriert

```{r,eval=F}
demo(sf::affine)
```

![](figure/Rplot.pdf)

## Beispieldaten bekommen

<!--
https://cran.r-project.org/web/packages/sf/vignettes/sf1.html
-->

```{r}
library(osmdata)
bb_poly <- getbb(place_name = "Amsterdam", 
                 format_out = "polygon")

```


```{r}
ls <- st_multilinestring(bb_poly)
```


```{r}
pol <- sf::st_polygon(bb_poly)
class(pol)
```

```{r,echo=F,eval=F}
ab <- st_polygonize(ls)
ab <- st_geometrycollection(list(pol))
str(ab)
```


```{r}
bb_poly_ma <- getbb(place_name = "Mannheim", 
                 format_out = "polygon")
```

## Das Ergebnis plotten

```{r}
plot(bb_poly_ma)
```

<!--
## Das Beispiel Heidelberg

```{r,eval=F}
bb_poly_hd <- getbb(place_name = "Heidelberg", 
                 format_out = "polygon")
```
-->

```{r,eval=F,echo=F}
ls <- st_multilinestring(bb_poly_ma)
ab <- st_polygonize(ls)
```


<!--
Problem ist, dass man nichts sieht, wenn man das plottet

# folgendes funktioniert nicht
-->

```{r,eval=F,echo=F}
mpol <- sf::st_multipolygon(bb_poly)
```


```{r,echo=F}
# x <- osmdata_sf(pol)
```

## Ein Beispieldatensatz


```{r}
demo(nc, ask = FALSE, echo = FALSE)
```

## [Graphiken mit `sf`](https://r-spatial.github.io/sf/articles/sf5.html)


```{r message=FALSE, warning=FALSE}
plot(nc)
```


## [Shapefiles mit `sf` importieren](https://cran.r-project.org/web/packages/sf/vignettes/sf2.html)


```{r,eval=athome,echo=F}
data_path <- "D:/GESIS/data/"
```

```{r,eval=F,echo=F}
setwd(data_path)
plz <- st_read("post_pl.shp")
```

```{r}
lon <- st_read("../data/london_sport.shp")
```


## Das Shapefile plotten

```{r}
plot(lon$geometry)
```


<!--
https://www.r-spatial.org/r/2018/01/08/sf-0.6-0.html
-->




## Daten vom Amsterdam Beispiel

```{r}
datm <- st_read("../data/ams_centraal.osm","multipolygons")
```



## [Die Funktion `st_geometry`](https://cran.r-project.org/web/packages/sf/vignettes/sf3.html)

```{r}
geom_datm <- st_geometry(datm)
plot(geom_datm)
```


## Die Häuser auswählen

```{r message=FALSE, warning=FALSE}
library(dplyr)
buis <- datm %>% select(building)
plot(buis)
```

## Welche Häusertypen gibt es?

```{r,eval=F}
buis2 <- datm %>% as.data.frame %>% select(building)
```

```{r}
datbuis <- datm[, "building", drop = TRUE]
plot(datbuis)
```

##

```{r}
houses <- datm[datm$building == "house",]
class(houses)
## [1] "sf"         "data.frame"
dhous <- datm[houses,]
plot(dhous$geometry)
```

```{r}
plot(st_geometry(houses))
```

## [Alle Häuser herausnehmen](https://cran.r-project.org/web/packages/sf/vignettes/sf4.html)

```{r}
houses <- datm[datm$building %in% c("house","yes",
                                    "apartments"),]
plot(st_geometry(houses))
```



## Die Vignetten für das Paket `sf`

https://r-spatial.github.io/sf/reference/st_as_sf.html

https://r-spatial.github.io/sf/reference/st_read.html

https://r-spatial.github.io/sf/articles/sf1.html
